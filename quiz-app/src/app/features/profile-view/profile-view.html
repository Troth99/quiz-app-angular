<ng-template #loading>
  <app-loading></app-loading>
</ng-template>

<div *ngIf="loading$ | async; else loaded">
  <!-- Показва се докато зарежда -->
</div>

<ng-template #loaded>
  <div *ngIf="user$ | async as user; else notFound">
    <div class="profile-card">
      <div class="avatar-wrapper">
        <img [src]="user.photoUrl || 'default-profile.jpg'" alt="User Avatar" class="avatar" />
      </div>

      <div class="details">
        <h1>{{ user.displayName }}</h1>
        <p class="email">{{ user.email }}</p>

        <div class="dates">
          <div><strong>Member since:</strong> {{ user.createdAt | firestoreDate | date:'longDate' }}</div>
          <div><strong>Last login:</strong> {{ user.lastLogin | firestoreDate | date:'short' }}</div>
        </div>

        <div class="quiz-and-recent">
          <section class="quiz-stats">
            <h2>Quiz Statistics</h2>
            <ul>
              <li><strong>Quizzes Taken:</strong> {{ user.quizStats.quizzesTaken || 0 }}</li>
              <li><strong>Total Score:</strong> {{ user.quizStats.totalScore || 0 }}</li>
              <li><strong>Time Spent:</strong> {{ user.quizStats.timeSpent || 0 }} seconds</li>
            </ul>
          </section>

          <section class="recent-quizzes">
            <h2>Last Solved Quizzes</h2>
            <ng-container *ngIf="user.recentQuizzes?.length; else noQuizzes">
              <ul>
                <li *ngFor="let quiz of user.recentQuizzes">
                  <strong>{{ quiz.title }}</strong> — result: {{ quiz.score }}/{{ quiz.total }}
                  <span class="date">{{ quiz.date | date:'shortDate' }}</span>
                </li>
              </ul>
            </ng-container>
            <ng-template #noQuizzes>
              <p>No quizzes solved yet.</p>
            </ng-template>
          </section>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #notFound>
  <div class="not-found-message">
    User has been deleted or not found.
  </div>
</ng-template>
